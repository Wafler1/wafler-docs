{"version":3,"file":"preset-Y6J6llIV.js","names":[],"sources":["../src/config/preset.ts"],"sourcesContent":["import type { ProcessorOptions } from '@mdx-js/mdx';\nimport type { Pluggable } from 'unified';\nimport type * as Plugins from 'fumadocs-core/mdx-plugins';\nimport type { BuildEnvironment } from './build';\n\ntype ResolvePlugins = Pluggable[] | ((v: Pluggable[]) => Pluggable[]);\n\nexport type DefaultMDXOptions = Omit<\n  NonNullable<ProcessorOptions>,\n  'rehypePlugins' | 'remarkPlugins' | '_ctx'\n> & {\n  rehypePlugins?: ResolvePlugins;\n  remarkPlugins?: ResolvePlugins;\n\n  /**\n   * Properties to export from `vfile.data`\n   */\n  valueToExport?: string[];\n\n  remarkStructureOptions?: Plugins.StructureOptions | false;\n  remarkHeadingOptions?: Plugins.RemarkHeadingOptions;\n  remarkImageOptions?: Plugins.RemarkImageOptions | false;\n  remarkCodeTabOptions?: Plugins.RemarkCodeTabOptions | false;\n  remarkNpmOptions?: Plugins.RemarkNpmOptions | false;\n  rehypeCodeOptions?: Plugins.RehypeCodeOptions | false;\n};\n\nfunction pluginOption(\n  def: (v: Pluggable[]) => (Pluggable | false)[],\n  options: ResolvePlugins = [],\n): Pluggable[] {\n  const list = def(Array.isArray(options) ? options : []).filter(Boolean) as Pluggable[];\n\n  if (typeof options === 'function') {\n    return options(list);\n  }\n\n  return list;\n}\n\nexport type MDXPresetOptions =\n  | ({ preset?: 'fumadocs' } & DefaultMDXOptions)\n  | ({\n      preset: 'minimal';\n    } & ProcessorOptions);\n\n/**\n * apply MDX processor presets\n */\nexport function applyMdxPreset(\n  options: MDXPresetOptions = {},\n): (environment: BuildEnvironment) => Promise<ProcessorOptions> {\n  return async (environment = 'bundler') => {\n    if (options.preset === 'minimal') return options;\n\n    const plugins = await import('fumadocs-core/mdx-plugins');\n    const {\n      valueToExport = [],\n      rehypeCodeOptions,\n      remarkImageOptions,\n      remarkHeadingOptions,\n      remarkStructureOptions,\n      remarkCodeTabOptions,\n      remarkNpmOptions,\n      ...mdxOptions\n    } = options;\n\n    const remarkPlugins = pluginOption(\n      (v) => [\n        plugins.remarkGfm,\n        [\n          plugins.remarkHeading,\n          {\n            generateToc: false,\n            ...remarkHeadingOptions,\n          },\n        ],\n        remarkImageOptions !== false && [\n          plugins.remarkImage,\n          {\n            ...remarkImageOptions,\n            useImport: remarkImageOptions?.useImport ?? environment === 'bundler',\n          },\n        ],\n        'remarkCodeTab' in plugins &&\n          remarkCodeTabOptions !== false && [plugins.remarkCodeTab, remarkCodeTabOptions],\n        'remarkNpm' in plugins &&\n          remarkNpmOptions !== false && [plugins.remarkNpm, remarkNpmOptions],\n        ...v,\n        remarkStructureOptions !== false && [\n          plugins.remarkStructure,\n          {\n            exportAs: 'structuredData',\n            ...remarkStructureOptions,\n          } satisfies Plugins.StructureOptions,\n        ],\n        valueToExport.length > 0 &&\n          (() => {\n            return (_, file) => {\n              file.data['mdx-export'] ??= [];\n\n              for (const name of valueToExport) {\n                if (!(name in file.data)) continue;\n\n                file.data['mdx-export'].push({\n                  name,\n                  value: file.data[name],\n                });\n              }\n            };\n          }),\n      ],\n      mdxOptions.remarkPlugins,\n    );\n\n    const rehypePlugins = pluginOption(\n      (v) => [\n        rehypeCodeOptions !== false && [plugins.rehypeCode, rehypeCodeOptions],\n        ...v,\n        plugins.rehypeToc,\n      ],\n      mdxOptions.rehypePlugins,\n    );\n\n    return {\n      ...mdxOptions,\n      outputFormat: environment === 'runtime' ? 'function-body' : mdxOptions.outputFormat,\n      remarkPlugins,\n      rehypePlugins,\n    };\n  };\n}\n"],"mappings":";AA2BA,SAAS,aACP,KACA,UAA0B,EAAE,EACf;CACb,MAAM,OAAO,IAAI,MAAM,QAAQ,QAAQ,GAAG,UAAU,EAAE,CAAC,CAAC,OAAO,QAAQ;AAEvE,KAAI,OAAO,YAAY,WACrB,QAAO,QAAQ,KAAK;AAGtB,QAAO;;;;;AAYT,SAAgB,eACd,UAA4B,EAAE,EACgC;AAC9D,QAAO,OAAO,cAAc,cAAc;AACxC,MAAI,QAAQ,WAAW,UAAW,QAAO;EAEzC,MAAM,UAAU,MAAM,OAAO;EAC7B,MAAM,EACJ,gBAAgB,EAAE,EAClB,mBACA,oBACA,sBACA,wBACA,sBACA,kBACA,GAAG,eACD;EAEJ,MAAM,gBAAgB,cACnB,MAAM;GACL,QAAQ;GACR,CACE,QAAQ,eACR;IACE,aAAa;IACb,GAAG;IACJ,CACF;GACD,uBAAuB,SAAS,CAC9B,QAAQ,aACR;IACE,GAAG;IACH,WAAW,oBAAoB,aAAa,gBAAgB;IAC7D,CACF;GACD,mBAAmB,WACjB,yBAAyB,SAAS,CAAC,QAAQ,eAAe,qBAAqB;GACjF,eAAe,WACb,qBAAqB,SAAS,CAAC,QAAQ,WAAW,iBAAiB;GACrE,GAAG;GACH,2BAA2B,SAAS,CAClC,QAAQ,iBACR;IACE,UAAU;IACV,GAAG;IACJ,CACF;GACD,cAAc,SAAS,YACd;AACL,YAAQ,GAAG,SAAS;AAClB,UAAK,KAAK,kBAAkB,EAAE;AAE9B,UAAK,MAAM,QAAQ,eAAe;AAChC,UAAI,EAAE,QAAQ,KAAK,MAAO;AAE1B,WAAK,KAAK,cAAc,KAAK;OAC3B;OACA,OAAO,KAAK,KAAK;OAClB,CAAC;;;;GAIX,EACD,WAAW,cACZ;EAED,MAAM,gBAAgB,cACnB,MAAM;GACL,sBAAsB,SAAS,CAAC,QAAQ,YAAY,kBAAkB;GACtE,GAAG;GACH,QAAQ;GACT,EACD,WAAW,cACZ;AAED,SAAO;GACL,GAAG;GACH,cAAc,gBAAgB,YAAY,kBAAkB,WAAW;GACvE;GACA;GACD"}