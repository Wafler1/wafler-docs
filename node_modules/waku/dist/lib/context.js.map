{"version":3,"sources":["../../src/lib/context.ts"],"sourcesContent":["import { AsyncLocalStorage } from 'node:async_hooks';\n\ntype Context = {\n  readonly req: Request;\n  nonce: string | undefined;\n  readonly data: Record<string, unknown>;\n};\n\nconst contextStorage = new AsyncLocalStorage<Context>();\n\nexport function INTERNAL_runWithContext<T>(req: Request, next: () => T): T {\n  const context: Context = {\n    req,\n    nonce: undefined,\n    data: {},\n  };\n  return contextStorage.run(context, next);\n}\n\nexport function getContext() {\n  const context = contextStorage.getStore();\n  if (!context) {\n    throw new Error(\n      'Context is not available. Make sure to use the context middleware.',\n    );\n  }\n  return context;\n}\n\nexport function getContextData(): Record<string, unknown> {\n  const context = contextStorage.getStore();\n  if (!context) {\n    return {};\n  }\n  return context.data;\n}\n"],"names":["AsyncLocalStorage","contextStorage","INTERNAL_runWithContext","req","next","context","nonce","undefined","data","run","getContext","getStore","Error","getContextData"],"mappings":"AAAA,SAASA,iBAAiB,QAAQ,mBAAmB;AAQrD,MAAMC,iBAAiB,IAAID;AAE3B,OAAO,SAASE,wBAA2BC,GAAY,EAAEC,IAAa;IACpE,MAAMC,UAAmB;QACvBF;QACAG,OAAOC;QACPC,MAAM,CAAC;IACT;IACA,OAAOP,eAAeQ,GAAG,CAACJ,SAASD;AACrC;AAEA,OAAO,SAASM;IACd,MAAML,UAAUJ,eAAeU,QAAQ;IACvC,IAAI,CAACN,SAAS;QACZ,MAAM,IAAIO,MACR;IAEJ;IACA,OAAOP;AACT;AAEA,OAAO,SAASQ;IACd,MAAMR,UAAUJ,eAAeU,QAAQ;IACvC,IAAI,CAACN,SAAS;QACZ,OAAO,CAAC;IACV;IACA,OAAOA,QAAQG,IAAI;AACrB"}